import streamlit as st
import matplotlib.pyplot as plt
import numpy as np

# –¶–≤–µ—Ç–∞ –ø–ª–∞–Ω–µ—Ç –≤ –∏–Ω–¥–∏–π—Å–∫–æ–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏–∏
color_map = {
    1: '#E52B50', 2: '#87CEEB', 3: '#F4C430', 4: '#86261c',
    5: '#009B77', 6: '#FADADD', 7: '#b2beb5', 8: '#0047AB', 9: '#ff4040'
}

# –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∑–æ–Ω –≤ –º–∞–Ω–¥–∞–ª–µ
zone_coords = {
    1: [(4,4), (5,4), (6,4), (4,5), (5,5), (6,5), (4,6), (5,6), (6,6),
        (2,1), (2,2), (1,2), (8,1), (8,2), (9,2), (1,8), (2,8), (2,9), (8,8), (8,9), (9,8)],
    2: [(5,1), (4,2), (5,2), (6,2), (4,3), (5,3), (6,3),
        (2,4), (3,4), (1,5), (2,5), (3,5), (2,6), (3,6),
        (4,7), (5,7), (6,7), (4,8), (5,8), (6,8), (5,9),
        (7,4), (7,5), (7,6), (8,4), (8,5), (8,6), (9,5)],
    3: [(6,1), (3,3), (7,3), (1,4), (9,6), (3,7), (7,7), (4,9)],
    4: [(1,1), (3,1), (9,1), (9,3), (1,7), (1,9), (7,9), (9,9)]
}

# –ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
planet_info = {
    1: ("–°–æ–ª–Ω—Ü–µ", "—Ä—É–±–∏–Ω–æ–≤—ã–π", "–ª–∏–¥–µ—Ä—Å—Ç–≤–æ, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç, —è—Å–Ω–æ—Å—Ç—å"),
    2: ("–õ—É–Ω–∞", "—Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π", "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –º—è–≥–∫–æ—Å—Ç—å, –∏–Ω—Ç—É–∏—Ü–∏—è"),
    3: ("–Æ–ø–∏—Ç–µ—Ä", "—à–∞—Ñ—Ä–∞–Ω–æ–≤—ã–π", "–º—É–¥—Ä–æ—Å—Ç—å, –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ, —Ä–æ—Å—Ç"),
    4: ("–†–∞—Ö—É", "—á–∞–π–Ω—ã–π", "–∏–ª–ª—é–∑–∏–∏, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–∏"),
    5: ("–ú–µ—Ä–∫—É—Ä–∏–π", "–∏–∑—É–º—Ä—É–¥–Ω—ã–π", "—É–º, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è, –∞–¥–∞–ø—Ç–∞—Ü–∏—è"),
    6: ("–í–µ–Ω–µ—Ä–∞", "—Ä–æ–∑–æ–≤—ã–π", "–≥–∞—Ä–º–æ–Ω–∏—è, –ª—é–±–æ–≤—å, —ç—Å—Ç–µ—Ç–∏–∫–∞"),
    7: ("–ö–µ—Ç—É", "–¥—ã–º—á–∞—Ç—ã–π", "—É–µ–¥–∏–Ω–µ–Ω–∏–µ, –æ—Ç—Ä–µ—à—ë–Ω–Ω–æ—Å—Ç—å, –∏–Ω—Ç—É–∏—Ü–∏—è"),
    8: ("–°–∞—Ç—É—Ä–Ω", "—Å–∏–Ω–∏–π", "–∫–∞—Ä–º–∞, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è"),
    9: ("–ú–∞—Ä—Å", "–∞–ª—ã–π", "—ç–Ω–µ—Ä–≥–∏—è, –≤–æ–ª—è, –¥–µ–π—Å—Ç–≤–∏—è")
}

def reduce_to_digit(value):
    total = sum(int(d) for d in str(value) if d.isdigit())
    while total > 9:
        total = sum(int(d) for d in str(total))
    return total

def draw_grid(colors):
    zone_map = np.zeros((9, 9), dtype=int)
    for zone, coords in zone_coords.items():
        for x, y in coords:
            zone_map[y - 1, x - 1] = zone
    fig, ax = plt.subplots(figsize=(6, 6))
    for y in range(9):
        for x in range(9):
            zone = zone_map[y, x]
            color = color_map[colors[zone]] if zone in colors else 'white'
            rect = plt.Rectangle([x, 8 - y], 1, 1, facecolor=color, edgecolor='black')
            ax.add_patch(rect)
    ax.set_xlim(0, 9)
    ax.set_ylim(0, 9)
    ax.set_xticks(np.arange(9) + 0.5)
    ax.set_yticks(np.arange(9) + 0.5)
    ax.set_xticklabels(range(1, 10))
    ax.set_yticklabels(range(1, 10))
    ax.set_aspect('equal')
    plt.grid(True)
    st.pyplot(fig)

# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
st.title("–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –í–∞—Å—Ç—É –ú–∞–Ω–¥–∞–ª–∞")

st.markdown("""
–í–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–µ—Å—Ç–∞ ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à –¥–æ–º, —É—á–∞—Å—Ç–æ–∫, –∫–≤–∞—Ä—Ç–∏—Ä–∞ –∏–ª–∏ –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã.  
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å, –≤–≤–µ–¥—è –∞–¥—Ä–µ—Å –Ω–∞ [—ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ](https://snipp.ru/tools/address-coord).  
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è —à–∏—Ä–æ—Ç—ã –∏ –¥–æ–ª–≥–æ—Ç—ã –≤ –ø–æ–ª—è –Ω–∏–∂–µ.

–ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –í–∞—Å—Ç—É-–º–∞–Ω–¥–∞–ª–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π:

- –∫–∞–∂–¥–∞—è –∑–æ–Ω–∞ –æ–∫—Ä–∞—à–µ–Ω–∞ –≤ —Ü–≤–µ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–ª–∞–Ω–µ—Ç–µ,
- –ø–ª–∞–Ω–µ—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å—É–º–º–æ–π –≥—Ä–∞–¥—É—Å–æ–≤ –∏ –º–∏–Ω—É—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –¥–æ–ª–≥–æ—Ç—ã –∏ —à–∏—Ä–æ—Ç—ã.
- –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫—Ä–∞—Ç–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä—É.
""")

lat_input = st.text_input("–°–µ–≤–µ—Ä–Ω–∞—è —à–∏—Ä–æ—Ç–∞", "65.026802")
lon_input = st.text_input("–í–æ—Å—Ç–æ—á–Ω–∞—è –¥–æ–ª–≥–æ—Ç–∞", "35.709128")

if st.button("–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞–Ω–¥–∞–ª—É"):
    try:
        lat = float(lat_input)
        lon = float(lon_input)

        lat_deg = int(lat)
        lat_min = int(round((lat - lat_deg) * 60))
        lon_deg = int(lon)
        lon_min = int(round((lon - lon_deg) * 60))

        z1 = reduce_to_digit(lat_deg)
        z2 = reduce_to_digit(lon_deg)
        z3 = reduce_to_digit(lat_min)
        z4 = reduce_to_digit(lon_min)

        st.markdown(f"**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º:**")
        st.markdown(f"–ó–æ–Ω–∞ 1 (–≥—Ä–∞–¥—É—Å—ã —à–∏—Ä–æ—Ç—ã): {z1} ‚Äî {planet_info[z1][0]} ({planet_info[z1][1]}, {planet_info[z1][2]})")
        st.markdown(f"–ó–æ–Ω–∞ 2 (–≥—Ä–∞–¥—É—Å—ã –¥–æ–ª–≥–æ—Ç—ã): {z2} ‚Äî {planet_info[z2][0]} ({planet_info[z2][1]}, {planet_info[z2][2]})")
        st.markdown(f"–ó–æ–Ω–∞ 3 (–º–∏–Ω—É—Ç—ã —à–∏—Ä–æ—Ç—ã): {z3} ‚Äî {planet_info[z3][0]} ({planet_info[z3][1]}, {planet_info[z3][2]})")
        st.markdown(f"–ó–æ–Ω–∞ 4 (–º–∏–Ω—É—Ç—ã –¥–æ–ª–≥–æ—Ç—ã): {z4} ‚Äî {planet_info[z4][0]} ({planet_info[z4][1]}, {planet_info[z4][2]})")

        draw_grid({1: z1, 2: z2, 3: z3, 4: z4})

        if any(z in [4, 7, 8, 9] for z in [z1, z2, z3, z4]):
            st.warning("–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–æ–Ω—ã, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –†–∞—Ö—É, –ö–µ—Ç—É, –°–∞—Ç—É—Ä–Ω–æ–º –∏–ª–∏ –ú–∞—Ä—Å–æ–º. –í–æ–∑–º–æ–∂–Ω—ã –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏–ª–∏ –∏–∑–æ–ª—è—Ü–∏—è.")
            st.markdown("**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ —Å–≤–µ—Ç, —á–∏—Å—Ç–æ—Ç—É, –º–∞–Ω—Ç—Ä—ã –∏ —è–Ω—Ç—Ä—ã, —Å–∏–º–≤–æ–ª—ã –±–ª–∞–≥–æ—Ç–≤–æ—Ä–Ω—ã—Ö –ø–ª–∞–Ω–µ—Ç: –Æ–ø–∏—Ç–µ—Ä, –õ—É–Ω–∞ –∏ –°–æ–ª–Ω—Ü–µ, –∂–∏–≤–æ–π –æ–≥–æ–Ω—å, –±–ª–∞–≥–æ–≤–æ–Ω–∏—è –∏ –∑–≤—É–∫–∏. –ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ —Ü–≤–µ—Ç–∞–º–∏ –†–∞—Ö—É, –ö–µ—Ç—É, –°–∞—Ç—É—Ä–Ω–∞ –∏–ª–∏ –ú–∞—Ä—Å–∞ –≤ –∏–Ω—Ç–µ—Ä—å–µ—Ä–µ, —Å–±–∞–ª–∞–Ω—Å–∏—Ä—É–π—Ç–µ –∏—Ö –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–º –ø–µ—Å–æ—á–Ω—ã–º —Ü–≤–µ—Ç–æ–º –∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏: –¥–µ—Ä–µ–≤–æ, –∫–∞–º–µ–Ω—å, –ª—ë–Ω.**")

        st.markdown("""
---

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞—Å—á—ë—Ç**

–ú—ã –ø–µ—Ä–µ–≤–æ–¥–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –≥—Ä–∞–¥—É—Å—ã –∏ –º–∏–Ω—É—Ç—ã:
- —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ ‚Äî —ç—Ç–æ –≥—Ä–∞–¥—É—Å—ã,
- –¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ –º–∏–Ω—É—Ç—ã (1¬∞ = 60‚Ä≤),
- –∑–∞—Ç–µ–º —Å—É–º–º–∞ —Ü–∏—Ñ—Ä —Å–≤–æ–¥–∏—Ç—Å—è –∫ —á–∏—Å–ª—É –æ—Ç 1 –¥–æ 9.

–û—Å–Ω–æ–≤–∞ —Ä–∞—Å—á—ë—Ç–∞ ‚Äî **—Å–≤–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –í–∞—Å—Ç—É-–º–∞–Ω–¥–∞–ª–∞ –Æ–∂–Ω–æ–π –ò–Ω–¥–∏–∏**, –≤ –∫–æ—Ç–æ—Ä–æ–π 9√ó9 –∑–æ–Ω —Å–æ–≥–ª–∞—Å—É—é—Ç—Å—è —Å –ø–ª–∞–Ω–µ—Ç–∞–º–∏ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º.

---

### üìå –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–Ω–¥–∞–ª—É:
- –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ—é –º–∞–Ω–¥–∞–ª—É
- –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ü–æ–≤–µ—Å—å—Ç–µ –≤ –¥–æ–º–µ –∏–ª–∏ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—è—Å—å –ø–æ —Å—Ç–æ—Ä–æ–Ω–∞–º —Å–≤–µ—Ç–∞ ‚Äî —Å–µ–≤–µ—Ä –≤–≤–µ—Ä—Ö—É)
- –£–∫—Ä–∞—Å—å—Ç–µ —Å–µ–∫—Ç–æ—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏, —Å–∏–º–≤–æ–ª–∞–º–∏, –ª–∞–º–ø–∞–º–∏, –±–ª–∞–≥–æ–≤–æ–Ω–∏—è–º–∏ –∏–ª–∏ –º–∞–Ω—Ç—Ä–∞–º–∏.
""")

    except ValueError:
        st.error("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.")

st.markdown("""
---

üîç **–î–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–π –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –í–∞—Å—Ç—É-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π –ø–æ [—ç—Ç–æ–π —Å—Å—ã–ª–∫–µ](https://goroskop1008.ru/uslugi/#consult#!/tproduct/842449103-1607970659374)**

üõ†Ô∏è –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ **–°. –ê. –ö—Ä–æ–π—Ü–µ—Ä**  
–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
""")
